# hash算法

## 什么是hash算法

> 将任意长度的二进制值串映射为固定长度的二进制值串，这个映射的规则就是**哈希算法**。

## 设计优秀hash算法的要求

1. 从哈希值不能反向推导出原始数据（所以哈希算法也叫单向哈希算法）；
1. 对输入数据非常敏感，哪怕原始数据只修改了一个 Bit，最后得到的哈希值也大不相同；
1. 散列冲突的概率要很小，对于不同的原始数据，哈希值相同的概率非常小；
1. 哈希算法的执行效率要尽量高效，针对较长的文本，也能快速地计算出哈希值。

## 应用

常见的：安全加密、唯一标识、数据校验、散列函数、负载均衡、数据分片、分布式存储。

### 安全加密

- MD5 (MD5 Message-Digest Algorithm，MD5 消息摘要算法)
- SHA (Secure Hash Algorithm，安全散列算法）

**格外重要的要求**

1. 反向推导出原始数据，
2. 散列冲突的概率要很小
   1. 我们只能尽量减少碰撞冲突的概率，理论上是没办法做到完全不冲突的 - 鸽巢原理（抽屉原理）

**冲突**

哈希值越长的哈希算法，散列冲突的概率越低。

**总结**

没有绝对安全的加密。越复杂、越难破解的加密算法，需要的计算时间也越长。比如 SHA-256 比 SHA-1 要更复杂、更安全，相应的计算时间就会比较长。

我们在实际的开发过程中，也需要权衡破解难度和计算时间，来决定究竟使用哪种加密算法。

### 唯一标识

以图片为例：

给每一个图片取一个唯一标识，或者说信息摘要。比如，

1. 从图片的二进制码串开头取 100 个字节，从中间取 100 个字节，从最后再取 100 个字节，然后将这 300 个字节放到一块，
2. 通过哈希算法（比如 MD5），得到一个哈希字符串，用它作为图片的唯一标识
3. 通过这个唯一标识来判定图片是否在图库中

### 数据校验

BT下载文件块，下载的文件块有可能是被恶意修改或下载过程中出现错误的。

需要检测这种错误，校验文件块的安全、正确、完整：

1. 通过hash算法，对100个文件块分别取hash值，并且保存在种子文件中。
2. hash算法对数据很敏感，只要文件块内容有一点点变化，计算出来的hash值就有所不同
3. 以此来校验文件的正确性~，如果不同，再冲其他宿主机器下载这个文件块

### 散列函数

散列函数也是哈希算法的一种应用

- 散列函数对数据是否能反向解密不关心
- 散列算法冲突的要求比hash低很多，即便冲突也可以通过开放寻址法或链表法解决
- 它更关注是否能平均分布
- 比较简单，追求效率

## hash算法与密码

字典攻击：如果用户信息被“脱库”，黑客虽然拿到是加密之后的密文，但可以通过“猜”的方式来破解密码，这是因为，有些用户的密码太简单。比如很多人习惯用 00000、123456 这样的简单数字组合做密码，很容易就被猜中。

- 维护一个常用密码的字典表，把字典中的每个密码用哈希算法计算哈希值，然后拿哈希值跟脱库后的密文比对。
- 针对字典攻击，我们可以引入一个盐（salt），跟用户的密码组合在一起，增加密码的复杂度。
