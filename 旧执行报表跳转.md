

```
/*
	下面的 this._query 相当于 window.location.hash，取得是路径栏的hash值
*/

var _token = this._query['ths-sso-token'] || ''


if (_token) {
    window.sessionStorage.token = _token;
	this.SSOLogin();
} else {	// 目前走的是这里的逻辑
	// 判断路径地址有没有 userAccount 和 permitCode
    if (this._query.userAccount && this._query.permitCode) {
    	// this.tokenLogin 是一个普通函数，传入了两个参数，
    	this.tokenLogin(this._query.userAccount, this._query.permitCode);
    } else {
    	window.location.assign('/sso_login.jsp?target=' + encodeURIComponent(location.protocol + '//' + location.host + '/#/autologin'));
    }
}


// 登录逻辑
tokenLogin(userAccount, permitCode) {
	let _self = this;
	_self.getData('/UserService/user/loginToken.html', {
		userAccount: userAccount,
		permitCode: permitCode
	}).then(_data => {
		delete _data.code;
		delete _data.sessionId;
		delete _data.remark;
		_self.getData('/PermitService/permit/baseinfo/company/v1/querydetail', {
			permitId: _data.permitId
		}).then(_data2 => {
			_data.companyInfo = _data2.company_info;
			_self.setUserInfo(_data);	// 此处是旧系统将用户信息存在sessionStrage中使用的
			this.$router.push(`/report-types`);	// 跳转页面
			
		})
	}).catch(err => {});
}


SSOLogin() {
	let _self = this;
	_self.getData('/UserService/user/ssologin.html')
		.then(_data => {
			delete _data.code;
			delete _data.sessionId;
			delete _data.remark;
			_self.getData('/PermitService/permit/baseinfo/company/v1/querydetail', {
				permitId: _data.permitId
			}).then(_data2 => {
				_data.companyInfo = _data2.company_info;
				_self.setUserInfo(_data);
				if (this._query.entryType === 1) {
					this.$router.push(`/report-upload-list`);						
				} else {
					this.$router.push(`/report-types`);
				}
			})
		})
		.catch(err => {
			this.login();
		});
},

```

