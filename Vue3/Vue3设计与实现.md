# 框架设计概览

## 权衡的艺术

- 命令式 和 声明式 做了什么
  - 命令式
    - 描述做事的过程 : 设置 dom 的内容
    - 一步步的命令程序做事
  - 声明式
    - 描述做事的结果 : <div > 内容 </div>
    - 告诉程序要做的事情,程序自己去做.
- 命令式 和 声明式 的效率 ( 性能和可维护性的权衡)
  - 命令式直接与程序交互,所以效率高于声明式
  - 声明式 = 声明 -> 翻译 -> 命令式
    - 在翻译的时候可以进行差异对比, 但是依然比同条件下命令式更消耗性能.
- 为什么 Vue 使用声明式 而不使用命令式
  - 声明式 好维护 -> 不关心过程
- 虚拟DOM的产生
  - 为了最小化的找出差异这一步的性能消耗
- 虚拟DOM有无对比
  - 创建阶段
    - 有:先组织虚拟DOM -> 渲染所有DOM
    - 无:渲染所有DOM
  - 更新阶段
    - 有:虚拟DOM计算节点  -> 渲染需要更新的DOM
    - 无:渲染所有DOM
  - 对比结果
    - 虚拟DOM 解决了更新新能差的问题.做到哪个DOM更新就更新那个.
- 性能: innerHTML < 虚拟DOM 计算 < 直接修改指定DOM
- 维护性: 虚拟DOM > innerHTML > 直接更改指定DOM

## 运行时 - 编译时 - 运行时 + 编译时

- 三钟状态
  - 运行时 : 程序拿想吃的内容变成运行的结果.
  - 编译时 : 用户提供的内容 -> 程序运行的结果.
  - 编译时 + 运行时 = 用户提供的内容 -> 转环 -> 程序吃.-> 结果
- 3 种框架的对比
  - 纯运行: React ( JSX -> Js 所以更改需要更改 JSX)
  - 编译加运行: Vue ( html -> vDOM -> js 所以更改时更改 vDOM)
  - 纯编译 : Svelte ( 直接把 html -> js 运行 , 所以他 更改以后需要直接js运行更改)

## 框架设计要素

- 提供那些构建产物
- 产物的模块格式
- 如果打印合适的警告信息 , 如果快速的定位问题
  - 快速定位问题, 节省时间.
  - 如何实现通用 错误处理提示函数(?)
  - 自定义 log 信息 (?) (vue initCustomFormatter 实现)
  - 使用环境变量来减少 开发相关提示 .
- 区分生产和测试环境.
- 区分构建产物的各种格式
  - webpack 和 vite 的 环境变量问题
  - cjs
  - iife
  - es
    - script 引入 环境变量 `__DEV__`
    - module 引入 环境变量 `process.env.NODE_ENV`
- 热更新
- 按需引入
- 常用打包工具支持

## 衡量框架指标

1. 开发体验
2. 框架代码体积
3. Tree-Shaking
4. Typescript 支持
5. 错误处理
6. 特性开关

## Tree-Shaking

1. Tree-Shaking 会删除没有被引用的函数
2. Tree-Shaking 会删除 人为标记无效的函数

## 特性开关设计

1. 用户没用到的,可以使用 tree-Shaking 删掉

> 例如 vue3 可以关闭 选项形式 , 这样可以节省代码.
>
## 错误处理

1. 通用错误处理.统一拦截

## 什么是良好的ts 支持

1. 框架由ts编写,不一定是好的ts支持.

# 第三章 Vue.js 3 的设计思路
